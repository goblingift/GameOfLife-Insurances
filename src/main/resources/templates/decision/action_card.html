<!DOCTYPE html>
<!--
Copyright (C) 2021 Andre Kessler (https://github.com/goblingift)
All rights reserved
-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
    <div class="modal-content" th:fragment="replace_fragment">
        <div id="replace_div">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel" th:text="${actionCardText.insuranceType}"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"></span>
                </button>
            </div>
            <div class="modal-body">

                <form id="form_decision" method="POST">
                    <div class="form-group border p-1">
                        <a th:text="${actionCardText.damageCaseDescription}" />
                    </div>

                    <div class="form-group border p-1">
                        <a th:text="${actionCardText.damageCaseAdditionalDescription}" />
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Versicherungsschaden:</span>
                        </div>
                        <input type="text" class="form-control" readonly th:value="${actionCardText.damageAmount}">
                            <div class="input-group-append">
                                <span class="input-group-text">€</span>
                            </div>
                    </div>

                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Eigenanteil:</span>
                        </div>
                        <input type="text" class="form-control" readonly th:value="${actionCardText.damageAmountToPay}">
                            <div class="input-group-append">
                                <span class="input-group-text">€</span>
                            </div>
                    </div>


                    <div class="row">
                        <div class="col" align="center">
                            <button name="submit" type="submit" class="btn btn-success" style="height: 60px; width: 50%;">Okay</button>
                        </div>
                    </div>
                </form>
            </div>

            <script th:inline="javascript">

                $("#form_decision").submit(function (e) {

                    e.preventDefault();

                    var level = $("#input_level").val();
                    var answer = this.answer.value;

                    console.log("will fire ajax post with params:");
                    console.log("level=" + level);

                    $.post("/game/make-decision",
                            {level: level, answer: null},
                            function (response) {

                                console.log("Successful submitted answer- will update UI for next card now!");
                                $.get("/game/get-dialog").done(function (fragment) { // get from controller
                                    $("#replace_div").replaceWith(fragment); // update snippet of page
                                });

                                // Update level counter
                                $('#input_level').val(parseInt(level) + 1);
                            }
                    );

                    // Adding visual box
                    $('#modal-dialog').modal('hide');

                    return true;
                });
            </script>
        </div>
    </div>
</html>